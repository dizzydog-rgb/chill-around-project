import"./all-DcTbhZgf.js";import"./main-BX2b4uAz.js";import"./login-nusU8p98.js";import{a as r}from"./axios-CCb-kr4I.js";const h=localStorage.getItem("emailid");console.log("emailid:",h);async function f(){try{const e=await r.get("http://localhost:8080/site/allsite/all/randomCity");console.log("取得資料"+e.data),console.log(e.data),e.data.forEach(o=>{S(o)}),g(),_()}catch(e){console.error("Error fetching random attractions:",e)}}document.addEventListener("DOMContentLoaded",()=>{const e=new URLSearchParams(window.location.search),a=e.get("site_city"),o=e.get("tag_id"),t=document.querySelectorAll(".cityCheckbox"),s=document.querySelectorAll(".tagCheckbox");a&&o?(t.forEach(n=>{n.checked=a===n.value}),s.forEach(n=>{n.checked=o===n.value}),u()):f()});function u(){const e=Array.from(document.querySelectorAll(".cityCheckbox:checked")).map(o=>o.value).join(","),a=Array.from(document.querySelectorAll(".tagCheckbox:checked")).map(o=>o.value).join(",");console.log(`Selected regions: ${e}, selected tags: ${a}`),!e&&!a?(document.addEventListener("DOMContentLoaded",()=>{f()}),g()):r.get("http://localhost:8080/site/allsite/select",{params:{site_city:e,tag_id:a}}).then(o=>{const t=o.data,s=document.getElementById("sitecardBox");s.innerHTML="",console.log("updateCard裡的attraction",t),t.length===0&&(s.innerHTML="<p>沒有符合條件的景點。</p>"),t.forEach(n=>{S(n)}),g(),_()}).catch(o=>{console.error("Error fetching attractions:",o),alert("無法獲取資料，請稍後再試。")})}function S(e){console.log("createCard裡面attraction",e);const a=document.getElementById("sitecardBox"),o=document.createElement("div");o.classList.add("col-md-3","p-0","m-0"),o.innerHTML=`
            <div id="siteCard" class="siteCard allCard card bg-primary" data-site-id="${e.site_id}">
            <div class="cardImage">
                <img src="../assets/images/searchSite/${e.photo_one}" alt="">
            </div>
            <div class="cardOverlay">
                <h5 class="card-title ">${e.site_name}</h5>
                <p class="card-subtitle">${e.short_add}</p>
            </div>
            <div id="addBtn" class="btnOverlay">   
                        <button type="button" class="addBtn btn btn-primary loadSchedule" 
                            data-site-id="${e.site_id}" 
                            data-site-name="${e.site_name}" 
                            data-site-add="${e.short_site_add}"
                            data-site-info="${e.site_info}"
                            data-site-img="${e.photo_one}"
                            data-bs-toggle="modal" 
                            data-bs-target="#exampleModal">
                            加入行程
                        </button> 
            </div>
        </div>
                `,console.log(a),a.appendChild(o)}function g(){const e=document.querySelectorAll(".siteCard");console.log(e),e.forEach(a=>{a.onclick=function(o){if(o.target.tagName==="BUTTON")return;const t=this.getAttribute("data-site-id");console.log(t),window.location.href=`/chill-around-project/pages/siteInfo.html?id=${t}`}})}function _(){let e,a;document.querySelectorAll(".loadSchedule").forEach(t=>{t.addEventListener("click",async s=>{if(!token){s.preventDefault(),s.stopPropagation(),alert("請先登入"),window.location.href="index.html";return}s.stopPropagation();const n=t.getAttribute("data-site-id"),c=t.getAttribute("data-site-name"),m=t.getAttribute("data-site-add"),y=t.getAttribute("data-site-info"),d=t.getAttribute("data-site-img");a={site_id:n,site_name:c,site_add:m,site_info:y,site_img:d},console.log(a);try{const{data:i}=await r.get(`http://localhost:8080/schInfo/getspot/${h}`);console.log("Email ID:",h),console.log("獲取的行程資料:",i);const p=document.getElementById("itinerarySelect");p.innerHTML='<option value="" selected>請選擇行程</option>';const v=i.schedules.map(l=>`<option value="${l.sch_name}" data-schedule-id="${l.sch_id}" data-days="${l.days}">${l.sch_name}</option>`).join("");p.innerHTML+=v,E()}catch(i){console.error("獲取行程資料失敗",i)}})}),document.getElementById("itinerarySelect").addEventListener("change",()=>{const t=document.querySelector("#itinerarySelect :checked"),s=Number(t.dataset.days)+1;e=t.dataset.scheduleId;const n=document.getElementById("daySelectContainer"),c=document.getElementById("daySelect");if(c.innerHTML="",s){n.style.display="block",console.log("選取的天數:",s);const m=Array.from({length:s},(y,d)=>`<option value="${d+1}">第 ${d+1} 天</option>`).join("");c.innerHTML+=m}else n.style.display="none",c.innerHTML='<option value="">請先選擇行程</option>'}),document.querySelector(".Save").addEventListener("click",async()=>{const t=Number(document.getElementById("daySelect").value),s={sch_id:e,sch_day:t,sch_order:"1",sch_spot:a.site_name,sch_info:a.site_info,sch_img:a.site_img};try{await r.post("http://localhost:8080/schInfo/getspot/add",s),alert("行程保存成功"),console.log("Data to Save:",s),$("#exampleModal").modal("hide")}catch(n){alert("保存行程失敗"),console.error("保存行程失敗",n)}})}function E(){const e=document.getElementById("exampleModal");e.classList.add("show"),e.style.display="block",document.body.classList.add("modal-open")}document.querySelectorAll(".cityCheckbox").forEach(e=>{e.addEventListener("change",u)});document.querySelectorAll(".tagCheckbox").forEach(e=>{e.addEventListener("change",u)});
