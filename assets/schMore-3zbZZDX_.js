import"./all-DcTbhZgf.js";import"./login-nusU8p98.js";import"./main-BX2b4uAz.js";import{a as s}from"./axios-CCb-kr4I.js";const i=localStorage.getItem("emailid");console.log("emailid:",i);function g(t,e){return t.length<=e?t:t.sort(()=>.5-Math.random()).slice(0,e)}document.addEventListener("DOMContentLoaded",()=>{const t=new URLSearchParams(window.location.search),e=t.get("site_city"),o=t.get("tag_id");console.log("URL Parameters:",e,o);const a=document.querySelectorAll(".cityCheckbox"),r=document.querySelectorAll(".tagCheckbox");e&&o?(a.forEach(c=>{c.checked=e===c.value}),r.forEach(c=>{c.checked=o===c.value}),n()):h()});async function l(){if(!localStorage.getItem("token"))return[];const e=localStorage.getItem("emailid");return(await s.get(`http://localhost:8080/schInfo/getLikedItems/${e}`)).data}function n(){const t=Array.from(document.querySelectorAll(".cityCheckbox:checked")).map(o=>o.value).join(","),e=Array.from(document.querySelectorAll(".tagCheckbox:checked")).map(o=>o.value).join(",");!t&&!e?h():s.get("http://localhost:8080/schInfo/getsch",{params:{site_city:t,tag_id:e}}).then(o=>{const a=o.data,r=document.getElementById("sitecardBox");r.innerHTML="",console.log("更新的卡片資料",a),a.length===0?r.innerHTML='<h4 class ="mt-5">沒有符合條件的行程</h4>':l().then(c=>{d(a,c)})}).catch(o=>{console.error("Error fetching attractions:",o)})}function d(t,e){console.log("取得的渲染資料",t);const o=document.getElementById("sitecardBox");o.innerHTML="",t.forEach(a=>{const r=document.createElement("div");let c=a.edit_date.slice(0,10);r.className="col-md-4 p-0 m-0";const m=e.includes(a.sch_id)?"bi-heart-fill":"bi-heart";r.innerHTML=`
            <div id="siteCard" class="allCard card bg-primary m-0" data-sch-id="${a.sch_id}">
                <div class="cardImage">
                    <img src="../assets/images/searchSite/${a.photo_one}" alt="">
                </div>
                <div class="cardOverlay">
                    <h5 class="card-title">${a.sch_name}</h5>
                    <p class="card-subtitle">${c}</p>
                </div>
                <div class="btnOverlay">
                    <a id="likeBtn" class="bi ${m}" 
                       data-email-id="${a.emailid}"
                       data-sch-id="${a.sch_id}">
                    </a>
                </div>
            </div>
        `,o.appendChild(r)}),u()}function u(){p(),f()}function h(){s.get("http://localhost:8080/schInfo/getsch").then(t=>{const e=t.data;if(console.log("API 隨機的景點資料:",e),Array.isArray(e)&&e.length>0){const o=g(e,12);l().then(a=>{d(o,a)})}else console.error("資料格式不正確或沒有資料。",e)}).catch(t=>{console.error("Error fetching random attractions:",t)})}function f(){document.querySelectorAll(".allCard").forEach(t=>{t.addEventListener("click",e=>{e.stopPropagation();const o=e.currentTarget.getAttribute("data-sch-id");localStorage.setItem("selectedSchId",o),console.log("點擊的卡片id",o),window.location.href="schCom.html"})})}function p(){document.querySelectorAll(".bi-heart, .bi-heart-fill").forEach(t=>{t.addEventListener("click",function(e){if(e.stopPropagation(),!token){e.preventDefault(),e.stopPropagation(),alert("請先登入"),window.location.href="index.html";return}const o=e.target.classList.contains("bi-heart-fill"),a=e.target.getAttribute("data-sch-id");e.target.getAttribute("data-email-id");const r={emailid:i,sch_id:a};o?s.delete("http://localhost:8080/schInfo/removeLike",{data:r}).then(c=>{console.log("資料已成功刪除:",r),alert("已取消"),e.target.classList.add("bi-heart"),e.target.classList.remove("bi-heart-fill")}).catch(c=>{alert("取消失敗"),console.error("無法刪除資料:",c)}):s.post("http://localhost:8080/schInfo/getToLike",r).then(c=>{console.log("資料已成功發送:",r),alert("加入成功"),e.target.classList.add("bi-heart-fill"),e.target.classList.remove("bi-heart")}).catch(c=>{alert("加入失敗"),console.error("無法發送資料:",c)})})})}document.querySelectorAll(".cityCheckbox").forEach(t=>{t.addEventListener("change",n)});document.querySelectorAll(".tagCheckbox").forEach(t=>{t.addEventListener("change",n)});
