import"./all-DcTbhZgf.js";import{a as i}from"./axios-CCb-kr4I.js";localStorage.setItem("scheduleId","2");const r=localStorage.getItem("scheduleId");console.log("皮卡：目前從 localStorage 取得 sch_id: ------- ",r);i.get(`http://localhost:8080/item/Useritem/${r}`).then(d=>{const y=d.data.UseritemList,g=document.querySelector(".cardRow");g.innerHTML="";const f=y.reduce((e,t)=>(e[t.ItemName]?(e[t.ItemName].Total+=t.Quantity,t.PrepareStatus===1&&(e[t.ItemName].Quantity+=t.Quantity)):e[t.ItemName]={ItemName:t.ItemName,Total:t.Quantity,Quantity:t.PrepareStatus===1?t.Quantity:0,Icategory_id:t.Icategory_id},e),{}),S={服飾類:"../assets/images/Budget_Item/Items/apparel.png",個人護理類:"../assets/images/Budget_Item/Items/self_care.png",電子產品類:"../assets/images/Budget_Item/Items/electronic_cable.png",文件類:"../assets/images/Budget_Item/Items/files.png",金錢類:"../assets/images/Budget_Item/Items/payments.png",健康類:"../assets/images/Budget_Item/Items/health.png",旅行配件類:"../assets/images/Budget_Item/Items/travel_equipment.png",飲食類:"../assets/images/Budget_Item/Items/food.png",娛樂類:"../assets/images/Budget_Item/Items/playing.png",安全類:"../assets/images/Budget_Item/Items/safe.png",戶外活動類:"../assets/images/Budget_Item/Items/outdoor.png",小型工具類:"../assets/images/Budget_Item/Items/tools.png",清潔用品類:"../assets/images/Budget_Item/Items/clean.png",育兒類:"../assets/images/Budget_Item/Items/child_care.png",攝影設備類:"../assets/images/Budget_Item/Items/camera_equipment.png",旅行資料類:"../assets/images/Budget_Item/Items/files.png",家具類:"../assets/images/Budget_Item/Items/capable_furniture.png",其他類:"../assets/images/Budget_Item/Items/others.png"};Object.values(f).forEach(e=>_(e));function _(e){const t=document.createElement("div");t.classList.add("col-md-4","col-4","mb-3","cardOut");const o=document.createElement("div");o.classList.add("card"),o.id=`card-${e.Icategory_id}`;const s=S[e.ItemName];o.innerHTML=`
                <button class="rightDelete">–</button>
                <img src="${s}" class="cardImg" alt="卡片圖片">
                <div class="card-body" data-item-name="${e.ItemName}">
                    <span>${e.ItemName}</span>
                    <span>${e.Quantity} / ${e.Total}</span>
                </div>
            `,t.appendChild(o),g.appendChild(t),o.querySelector(".rightDelete").addEventListener("click",()=>B(e.ItemName,e.Icategory_id)),o.addEventListener("click",()=>k(e))}function B(e,t){confirm(`刪除${e}及其所有細項嗎？`)&&i.delete(`http://localhost:8080/item/Useritem/${r}/category/${t}`).then(o=>{console.log("刪除成功",o.data);const s=document.querySelector(`.card-body[data-item-name="${e}"]`).closest(".cardOut");s&&s.remove()}).catch(o=>{console.error("刪除失敗",o)})}function k(e){const t=e.ItemName,o=e.Icategory_id;u(),sessionStorage.setItem("selectedCardId",o);const s=document.querySelector(".categoryContainer");s.innerHTML="";const a=document.querySelector(".categoryText");a.textContent=t,d.data.UseritemList.filter(c=>c.ItemName===t).forEach(c=>I(c,s,t)),l(),u(),b(o,t)}function I(e,t,o){const s=document.createElement("div");s.classList.add("categoryContent");const a=e.ItemList_id||e.id;s.setAttribute("data-item-list-id",a);const n=e.ItemDetails,c=e.Quantity||0,m=e.PrepareStatus;s.innerHTML=`
                <input type="checkbox" class="checkBOX left" ${m===1?"checked":""}>
                <span class="itemContent left">${n}</span>
                <input type="number" class="itemQuantity right" min="1" value="${c}">
                <button class="leftDelete right">–</button>
            `,s.setAttribute("data-item-list-id",a),t.appendChild(s),s.querySelector(".leftDelete").addEventListener("click",$=>{$.stopPropagation(),console.log("嘗試刪除項 ID:",a),v(a)}),s.querySelector(".checkBOX").addEventListener("change",()=>{console.log("嘗試更新項:",o),p(s,o),l(),u()});const h=s.querySelector(".itemQuantity");return h.addEventListener("input",()=>{console.log("嘗試變更數量項:",h.value),p(s,o),l()}),s}function p(e,t){const o=e.getAttribute("data-item-list-id");if(!o){console.error("無效的項目 ID，無法更新");return}const s=e.querySelector(".checkBOX"),a=e.querySelector(".itemQuantity"),n={PrepareStatus:s.checked?1:0,Quantity:parseInt(a.value,10)||0,sch_id:r,ItemList_id:o,ItemName:t,ItemDetails:e.querySelector(".itemContent").textContent,Total:""};console.log("Updating item with ID:",o),console.log("Data to send for update:",n),i.put(`http://localhost:8080/item/Useritem/${r}`,n).then(c=>{console.log("更新成功",c.data)}).catch(c=>{console.error("更新失敗",c)})}function b(e,t){const o=document.getElementById("leftBtn");o.onclick=()=>C(e,t)}function C(e,t){const o=prompt("請輸入物品內容:");if(o){const s={PrepareStatus:0,Quantity:1,sch_id:r,ItemName:t,ItemDetails:[o],Total:"",Icategory_id:e};i.post(`http://localhost:8080/item/Useritem/${r}/details`,s).then(a=>{console.log("新增成功",a.data);const n=a.data.data;console.log("新增細項的響應",n);const c=document.querySelector(".categoryContainer");console.log("newItem 的完整內容:",JSON.stringify(n,null,2));const m=I(n,c,t);q(m,n,t)}).catch(a=>{console.error("新增失敗",a)})}else alert("您沒有輸入任何文字。")}function q(e,t,o){if(console.log("detailElement:",e),console.log("Updating item with ID:",t.id),!e){console.error("無法獲取細項元素，無法更新");return}const s=e.querySelector(".checkBOX"),a=e.querySelector(".itemQuantity");if(!s||!a){console.error("無法獲取勾選框或數量輸入框，無法更新");return}const n={PrepareStatus:s.checked?1:0,Quantity:parseInt(a.value,10)||0,sch_id:r,ItemList_id:t.id,ItemName:o,ItemDetails:e.querySelector(".itemContent").textContent,Total:""};console.log("Data to send for update:",n),i.put(`http://localhost:8080/item/Useritem/${r}`,n).then(c=>{console.log("更新成功",c.data)}).catch(c=>{console.error("更新失敗",c)})}function v(e){confirm("您確定要刪除這個項目嗎？")&&i.delete(`http://localhost:8080/item/Useritem/${r}/${e}`).then(t=>{console.log("刪除成功",t.data);const o=document.querySelector(`[data-item-list-id="${e}"]`);o&&o.remove(),l()}).catch(t=>{console.error("刪除失敗",t)})}function l(){const e=Array.from(document.querySelectorAll(".checkBOX")),t=e.length,o=e.filter(n=>n.checked).length,s=t>0?o/t*100:0,a=document.getElementById("progress-bar");a.style.width=s+"%",localStorage.setItem("progressPercentage",s)}window.addEventListener("DOMContentLoaded",()=>{L();const e=sessionStorage.getItem("selectedCardId");if(e){const t=document.getElementById(`card-${e}`);t&&t.click()}l()});function L(){const e=JSON.parse(localStorage.getItem("checkboxStates"));e&&Object.keys(e).forEach(t=>{const o=document.querySelectorAll(".checkBOX")[t];o&&(o.checked=e[t])})}function u(){const e={};document.querySelectorAll(".checkBOX").forEach((t,o)=>{e[o]=t.checked}),sessionStorage.setItem("checkboxStates",JSON.stringify(e))}}).catch(d=>{console.error("Error fetching data:",d)});
