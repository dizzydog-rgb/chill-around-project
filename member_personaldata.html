<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>會員中心</title>
    <link rel="stylesheet" href="./css/member_style.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css"
        integrity="sha512-Kc323vGBEqzTmouAECnVceyQqyqdsSiqLQISBL29aUW4U/M7pSPA/gEUZQqv1cwx4OnYxTxve5UMg5GT6L4JJg=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />
</head>

<body class="member">
    <div class="container-fluid">
        <div class="row">
            <div class="col-md-2 text-center">
                <a href="#">
                    <img src="./images/chillAround_logo_01.png">
                </a>
                <div class="sidebar text-start">
                    <div class="item">
                        <a href="member_personaldata.html"><i class="fa-solid fa-user me-3"></i>個人資訊</a>
                    </div>
                    <div class="item">
                        <a href="member_mytrip.html"><i class="fa-solid fa-calendar-days me-3"></i>我的行程</a>
                    </div>
                    <div class="item">
                        <a href="member_mycollection.html"><i class="fa-solid fa-heart me-3"></i>我的收藏行程</a>
                    </div>
                    <div class="item">
                        <a href="TaiwanEx.html"><i class="fa-solid fa-map-location-dot me-3"></i>台灣制縣地圖</a>
                    </div>
                </div>
            </div>
            <div class="col-md-10 personaldata">
                <div id="edit" class="text-end mb-3">
                    <button type="button" class="btn editbtn text-white">
                        <i class="fa-solid fa-pencil me-1"></i>編輯
                    </button>
                </div>
                <div id="write" class="text-end mb-3 hidden">
                    <button type="button" class="btn storebtn text-white">
                        儲存
                    </button>
                    <button type="button" class="btn cancelbtn text-white">
                        取消
                    </button>
                </div>
                <div class="mb-5">
                    <div class="card" style="max-width: 600px;">
                        <div class="row align-items-center g-0">
                            <div class="col-md-4">
                                <img id="img" src="">
                            </div>
                            <div class="col-md-8">
                                <div class="card-body">
                                    <p class="card-text ms-2">
                                        歡迎! <span id="uname"></span>
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="formList">
                    <form>
                        <div class="item">
                            <label class="col-form-label">姓名：</label>
                            <input type="text" name="uname" id="uname1" class="inpwrite" placeholder="請輸入姓名" readonly>
                        </div>
                        <div class="item">
                            <div>
                                <label class="col-form-label">電子信箱：</label>
                                <input type="text" name="email" id="email" class="inpwrite" placeholder="請輸入電子信箱"
                                    readonly>
                            </div>
                            <div>
                                <label class="col-form-label">密碼：</label>
                                <input type="text" name="pwd" id="pwd" class="inpwrite" placeholder="請輸入密碼" readonly>
                            </div>
                        </div>
                        <div class="item">
                            <div>
                                <label class="col-form-label">出生日期：</label>
                                <input type="text" name="birthday" id="birthday" class="inpwrite" placeholder="請輸入出生日期" onfocus="(this.type='date')"
                                    readonly>
                            </div>
                            <div>
                                <label class="col-form-label">性別：</label>
                                <input type="text" name="sex" id="sex" class="inpwrite" readonly>
                            </div>
                        </div>
                        <div class="item">
                            <label class="col-form-label">住址：</label>
                            <input type="text" name="address" id="address" class="inpwrite" placeholder="請輸入住址"
                                readonly>
                        </div>
                        <div class="item">
                            <label class="col-form-label">手機號碼：</label>
                            <input type="text" name="cellphonenum" id="cellphonenum" class="inpwrite"
                                placeholder="請輸入手機號碼" readonly>
                        </div>
                        <div class="item">
                            <label class="col-form-label">市內電話：</label>
                            <input type="text" name="telephonenum" id="telephonenum" class="inpwrite"
                                placeholder="請輸入市內電話" readonly>
                        </div>
                    </form>
                    <div class="bindaccount">
                        <div class="title">綁定帳戶：</div>
                        <div class="googleline">
                            <div class="item">
                                <img src="./images/logo_google_g_icon.png" id="googleimg">
                                <div>已綁定</div>
                            </div>
                            <div class="item">
                                <img src="./images/btn_base.png" id="lineimg">
                                <div>未綁定</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script>
        $(document).ready(function () {
            // 獲取會員資料
            $.ajax({
                url: '/members',
                type: 'GET',
                success: function (res) {
                    if (res.length > 0) {
                        const member = res[0]; // 假設只有一個會員
                        $('#img').prop('src', './images/' + member.uphoto)
                        $('#uname').html(member.uname);
                        $('#uname1').val(member.uname);
                        $('#email').val(member.email);
                        $('#pwd').val(member.password);
                        let birthday = new Date(member.birthday);
                        let myBirthday = birthday.toLocaleDateString('zh-TW'); // 以台灣格式顯示
                        $('#birthday').val(myBirthday.split('/').join('-'));
                        $('#sex').val(member.sex);
                        $('#address').val(member.address);
                        $('#cellphonenum').val(member.cellphone);
                        $('#telephonenum').val(member.telephone);

                        function inputSize(input) {
                            input.attr('size', input.val().length + 1)
                        }

                        $('.inpwrite').each(function () {
                            inputSize($(this)); // 調整初始大小
                        });

                        $('.inpwrite').keyup(function () {
                            inputSize($(this));
                        });

                        $('.editbtn').click(function () {
                            // 切換 readonly 屬性
                            $('#edit').addClass('hidden');
                            $('#write').removeClass('hidden');
                            let input = $('.inpwrite');
                            input.css({ 'border': '1px solid #d2d2d2' }, { 'outline': 'solid thin' });
                            if (input.prop('readonly')) {
                                input.prop('readonly', false); // 取消 readonly
                            }
                        });

                        $('.cancelbtn').click(function () {
                            $('#edit').removeClass('hidden');
                            $('#write').addClass('hidden');
                            $('#birthday').prop('type', 'text');
                            $('#birthday').val(myBirthday.split('/').join('-'));
                            let input = $('.inpwrite');
                            input.css({ 'border': 'none' }, { 'outline': 'none' });
                            if (!input.prop('readonly')) {
                                input.prop('readonly', true);
                            }
                        });
                    }
                },
                error: function () {
                    alert("資料讀取失敗");
                }
            });
        });
    </script>
</body>

</html>