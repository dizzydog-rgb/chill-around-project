<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
    <title>會員登入</title>
</head>

<body>
    <button type="button" class="btn text-white loginbtn" data-bs-toggle="modal"
        data-bs-target="#loginModal">登入</button>

    <div class="modal fade login" id="loginModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="form">
                        <h3 class="mb-3 text-center">會員登入</h3>
                        <div class="mb-3">
                            <label for="inputAccount" class="col-form-label">帳號:</label>
                            <input type="text" class="form-control" id="inputAccount" name="inputAccount">
                        </div>
                        <div class="mb-3">
                            <label for="inputPassword" class="col-form-label">密碼:</label>
                            <input type="password" class="form-control" id="inputPassword" name="inputPassword">
                        </div>
                        <div class="mb-3 text-center">
                            <button id="loginbtn" type="submit" class="btn signinbtn text-white me-3">登入</button>
                            <a href="register.html" class="btn registerbtn text-white">會員註冊</a>
                        </div>
                    </form>
                </div>
                <div class="mx-2 text-center fastlogin">
                    <div class="line"></div>
                    <div class="mx-1">快速登入</div>
                    <div class="line"></div>
                </div>
                <div class="modal-footer">
                    <button class="btn lineloginbtn"></button>
                    <div id="g_id_onload"
                        data-client_id="745588392722-ldt3hokig9ll3mk6nekm1qmj9apnipo5.apps.googleusercontent.com"
                        data-auto_prompt="false">
                    </div>
                    <div class="g_id_signin" data-type="standard" data-size="medium" data-theme="filled_blue"
                        data-text="signin" data-shape="rectangular" data-logo_alignment="left" data-width=110>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script src="https://accounts.google.com/gsi/client" async></script>
    <script type="module" src="/main.js"></script>
    <script>
        $("#form").submit(function (e) {
            e.preventDefault();
            var formData = new FormData(this);
            var JSONData = JSON.stringify(Object.fromEntries(formData));
            console.log("Sending data:", JSONData);
            var account = $('#inputAccount').val();
            var password = $('#inputPassword').val();
            if (account == "" || password == "") {
                alert('請輸入帳號密碼!');
            } else {
                $.ajax({
                    url: "http://localhost:8080/member/login",
                    type: "POST",
                    contentType: "application/json; charset=utf-8",
                    data: JSONData,
                    success: function (res) {
                        if (res.token) {
                            localStorage.setItem('token', res.token);
                            alert("登入成功!");
                            window.location.href = 'member_personaldata.html';
                        }
                    },
                    error: function (xhr, status, error) {
                        if (xhr.responseJSON && xhr.responseJSON.message) {
                            alert(xhr.responseJSON.message);
                        } else {
                            alert("系統錯誤!");
                        }
                    }
                });
            }
        });
    </script>
</body>

</html>