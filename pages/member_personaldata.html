<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>會員中心</title>
    <link rel="stylesheet" href="./css/member_style.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css"
        integrity="sha512-Kc323vGBEqzTmouAECnVceyQqyqdsSiqLQISBL29aUW4U/M7pSPA/gEUZQqv1cwx4OnYxTxve5UMg5GT6L4JJg=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
</head>

<body class="member">
    <div class="container-fluid">
        <div class="row">
            <div class="col-md-2 text-center">
                <a href="#">
                    <img src="../assets/images/logo/chillAround_logo_01.png">
                </a>
                <div class="sidebar text-start">
                    <div class="item">
                        <a href="member_personaldata.html"><i class="fa-solid fa-user me-3"></i>個人資訊</a>
                    </div>
                    <div class="item">
                        <a href="member_mytrip.html"><i class="fa-solid fa-calendar-days me-3"></i>我的行程</a>
                    </div>
                    <div class="item">
                        <a href="member_mycollection.html"><i class="fa-solid fa-heart me-3"></i>我的收藏行程</a>
                    </div>
                    <div class="item">
                        <a href="TaiwanEx.html"><i class="fa-solid fa-map-location-dot me-3"></i>台灣制縣地圖</a>
                    </div>
                </div>
            </div>
            <div class="col-md-10 personaldata">
                <div id="edit" class="text-end mb-3">
                    <button type="button" class="btn editbtn text-white">
                        <i class="fa-solid fa-pencil me-1"></i>編輯
                    </button>
                </div>
                <div id="write" class="text-end mb-3 hidden">
                    <button type="button" class="btn storebtn text-white">
                        儲存
                    </button>
                    <button type="button" class="btn cancelbtn text-white">
                        取消
                    </button>
                </div>
                <div class="mb-5">
                    <div class="card" style="max-width: 600px;">
                        <div class="row align-items-center g-0">
                            <div class="col-md-4">
                                <img id="img" src="">
                            </div>
                            <div class="col-md-8">
                                <div class="card-body">
                                    <p class="card-text ms-2">
                                        歡迎! <span id="uname"></span>
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="formList">
                    <form>
                        <div class="item">
                            <label class="col-form-label">姓名：</label>
                            <input type="text" name="uname" id="uname1" class="inpwrite" placeholder="請輸入姓名" readonly>
                        </div>
                        <div class="item">
                            <div>
                                <label class="col-form-label">電子信箱：</label>
                                <input type="text" name="email" id="email" class="inpwrite" placeholder="請輸入電子信箱"
                                    readonly>
                            </div>
                            <div>
                                <label class="col-form-label">密碼：</label>
                                <input type="text" name="pwd" id="pwd" class="inpwrite" placeholder="請輸入密碼" readonly>
                            </div>
                        </div>
                        <div class="item">
                            <div>
                                <label class="col-form-label">出生日期：</label>
                                <input type="text" name="birthday" id="birthday" class="inpwrite" placeholder="請輸入出生日期"
                                    readonly>
                            </div>
                            <div>
                                <label class="col-form-label">性別：</label>
                                <input type="text" name="sex" id="sex" class="inpwrite" readonly>
                            </div>
                        </div>
                        <div class="item">
                            <label class="col-form-label">住址：</label>
                            <input type="text" name="address" id="address" class="inpwrite" placeholder="請輸入住址"
                                readonly>
                        </div>
                        <div class="item">
                            <label class="col-form-label">手機號碼：</label>
                            <input type="text" name="cellphonenum" id="cellphonenum" class="inpwrite"
                                placeholder="請輸入手機號碼" readonly>
                        </div>
                        <div class="item">
                            <label class="col-form-label">市內電話：</label>
                            <input type="text" name="telephonenum" id="telephonenum" class="inpwrite"
                                placeholder="請輸入市內電話" readonly>
                        </div>
                    </form>
                    <div class="bindaccount">
                        <div class="title">綁定帳戶：</div>
                        <div class="googleline">
                            <div class="item">
                                <img src="../assets/images/memberimg/logo_google_g_icon.png" id="googleimg">
                                <div id="google"></div>
                            </div>
                            <div class="item">
                                <img src="../assets/images/memberimg/btn_base.png" id="lineimg">
                                <div id="line"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script type="module" src="/main.js"></script>
    <script>
        $(document).ready(function () {
            // 獲取會員資料
            $.ajax({
                url: 'http://localhost:8080/member/members/1',
                type: 'GET',
                success: function (member) {
                    $('#img').prop('src', '../assets/images/memberimg/' + member.uphoto);
                    $('#uname').text(member.uname);
                    $('#uname1').val(member.uname);
                    $('#email').val(member.email);
                    $('#pwd').val(member.password);
                    let birthday = new Date(member.birthday);
                    let myBirthday = birthday.toLocaleDateString('zh-TW', {
                        year: 'numeric',
                        month: '2-digit',
                        day: '2-digit'
                    }).replace(/\//g, '-');
                    $('#birthday').val(myBirthday);
                    $('#sex').val(member.sex);
                    $('#address').val(member.address);
                    $('#cellphonenum').val(member.cellphone);
                    $('#telephonenum').val(member.telephone);
                    let googleid = member.googleid;
                    let lineid = member.lineid;
                    if (googleid == undefined) {
                        $('#google').text('未綁定');
                    } else {
                        $('#google').text('已綁定');
                    }

                    if (lineid == undefined) {
                        $('#line').text('未綁定');
                    } else {
                        $('#line').text('已綁定');
                    }

                    function inputSize(input) {
                        var minSize = 10;
                        input.attr('size', input.val().length)
                    }

                    $('.inpwrite').each(function () {
                        inputSize($(this)); // 調整初始大小
                    });

                    $('.inpwrite').on('input', function () {
                        inputSize($(this));
                    });

                    let datePicker;
                    $('.editbtn').click(function () {
                        $('#edit').addClass('hidden');
                        $('#write').removeClass('hidden');
                        let input = $('.inpwrite');
                        input.css({ 'border': '1px solid #d2d2d2' }, { 'outline': 'solid thin' });
                        input.prop('readonly', false); // 切換 readonly 屬性
                        datePicker = flatpickr("#birthday", {
                            dateFormat: "Y-m-d",
                            allowInput: true
                        });
                    });

                    $('.cancelbtn').click(function () {
                        let msg = "確定取消編輯?";
                        if (!confirm(msg)) return false;
                        $('#edit').removeClass('hidden');
                        $('#write').addClass('hidden');
                        let input = $('.inpwrite');
                        input.css({ 'border': 'none' }, { 'outline': 'none' });
                        input.prop('readonly', true); // 切換 readonly 屬性
                        if (datePicker) {
                            datePicker.destroy();
                        }
                        $('#birthday').val(myBirthday);
                    });
                },
                error: function () {
                    alert("資料讀取失敗");
                }
            });
        });
    </script>
</body>

</html>